# 📚 配信記録アプリ v2.2 セットアップガイド

## 🎯 このガイドについて

このガイドでは、**Google Apps Script を使った自動同期機能**の設定方法を、初心者の方でもわかるように説明します。

所要時間: **約10分**

---

## 📋 必要なもの

- ✅ Googleアカウント
- ✅ iPhone（Safari ブラウザ）
- ✅ このPWAアプリ（Netlifyなどにデプロイ済み）

---

## 🚀 セットアップ手順

### ステップ1: Googleスプレッドシートを作成（2分）

1. **Googleドライブを開く**
   - [https://drive.google.com](https://drive.google.com) にアクセス

2. **新しいスプレッドシートを作成**
   - 「新規」→「Googleスプレッドシート」→「空白のスプレッドシート」

3. **名前を付ける**
   - タイトルを「配信記録データベース」など、わかりやすい名前に変更

---

### ステップ2: Google Apps Script を設定（5分）

1. **Apps Script エディタを開く**
   - スプレッドシートのメニューから：
   - 「拡張機能」→「Apps Script」をクリック

2. **スクリプトコードを貼り付け**
   - 左側に表示されている「コード.gs」をクリック
   - デフォルトのコードを **すべて削除**
   - 提供された `google-apps-script.gs` ファイルの内容を **全てコピー&ペースト**

3. **プロジェクト名を設定**
   - 左上の「無題のプロジェクト」を「配信記録同期API」などに変更

4. **保存する**
   - 💾 アイコン（フロッピーディスク）をクリックして保存

---

### ステップ3: ウェブアプリとしてデプロイ（3分）

1. **デプロイメニューを開く**
   - 右上の「デプロイ」→「新しいデプロイ」をクリック

2. **種類を選択**
   - 「種類の選択」（歯車アイコン）をクリック
   - 「ウェブアプリ」を選択

3. **設定を入力**
   ```
   説明: 配信記録API v1
   次のユーザーとして実行: 自分（あなたのメールアドレス）
   アクセスできるユーザー: 自分のみ
   ```

4. **デプロイをクリック**
   - 「デプロイ」ボタンをクリック

5. **アクセス権限を承認**
   - 「アクセスを承認」をクリック
   - Googleアカウントを選択
   - 「詳細」→「配信記録同期API（安全ではないページ）に移動」をクリック
   - 「許可」をクリック

6. **ウェブアプリのURLをコピー**
   - 表示された「ウェブアプリ」のURLをコピー
   - 形式: `https://script.google.com/macros/s/XXXXX.../exec`
   - ⚠️ このURLは後で使うので、メモ帳などに保存しておいてください

---

### ステップ4: PWAアプリに設定（3分）

1. **iPhoneでアプリを開く**
   - ホーム画面の配信記録アプリをタップ

2. **設定タブを開く**
   - 下部のナビゲーションから「⚙️ 設定」をタップ

3. **スクリプトURLを入力**
   - 「📊 Googleスプレッドシート自動同期」セクション
   - 「スクリプトURL」欄に、コピーしたURLを貼り付け

4. **自動同期を有効化**
   - ✓ データ入力後に自動同期」にチェック
   - （オプション）「📶 WiFi接続時のみ同期」にチェック（通信量節約）

5. **接続テスト**
   - 「🔌 接続テスト」ボタンをタップ
   - ✅ 「接続成功！」と表示されればOK

6. **今すぐ同期**
   - 「🔄 今すぐ同期」ボタンをタップ
   - ✅ 「同期完了！」と表示されれば設定完了

---

## ✅ 確認方法

### iPhoneアプリ側
- 設定タブの「同期ステータス」が「✅ 同期済み」になっている
- 「最終同期」に日時が表示されている

### Googleスプレッドシート側
1. スプレッドシートに戻る
2. 以下のシートが自動作成されているか確認：
   - 「セッション記録」シート
   - 「目標設定」シート
   - 「同期ログ」シート
3. データが入力されていることを確認

---

## 🎉 完了！

これで、**データ入力後に自動的にGoogleスプレッドシートにバックアップ**されるようになりました！

---

## 📱 日常の使い方

### データを入力する
1. アプリで「📝 記録入力」タブを開く
2. 配信データを入力
3. 「保存」ボタンをタップ
4. ✅ 自動的にスプレッドシートに同期される！

### 同期状態を確認する
- 設定タブの「同期ステータス」で確認
- 緑色の「✅ 同期済み」なら正常

### オフラインで入力した場合
- WiFiに接続すると自動的に同期される
- 「未同期: X件」と表示されている場合は、「今すぐ同期」をタップ

---

## 🔧 トラブルシューティング

### ❌ 接続テストが失敗する

**原因1: URLが間違っている**
- デプロイ時にコピーしたURLを再確認
- 末尾が `/exec` で終わっているか確認

**原因2: アクセス権限が設定されていない**
- Apps Script の「デプロイ」→「デプロイを管理」
- 「アクセスできるユーザー」が「自分のみ」になっているか確認

**原因3: スクリプトにエラーがある**
- Apps Script エディタで「実行」→「doGet」を試す
- エラーログを確認

### ⚠️ 同期が「エラー」になる

**対処法1: 手動で同期を試す**
- 「今すぐ同期」ボタンをタップ

**対処法2: URLを再設定**
- スクリプトURLを削除して再入力
- 接続テストを再度実行

**対処法3: アプリを再読み込み**
- Safari でページを更新（リロード）

### 📊 スプレッドシートにデータが表示されない

**対処法1: シートの権限を確認**
- スプレッドシートが自分のGoogleアカウントで作成されているか確認

**対処法2: Apps Script の実行ログを確認**
- Apps Script エディタで「実行数」をクリック
- エラーログがないか確認

**対処法3: 手動でスクリプトを実行**
- Apps Script エディタで「実行」→「doPost」を試す

---

## 🆘 よくある質問

### Q1: スプレッドシートを他の人と共有できますか？
A: はい、可能です。ただし、**Apps Script のアクセス権限は「自分のみ」のままにしてください**。スプレッドシート自体は通常の方法で共有できます。

### Q2: 複数の端末で使えますか？
A: はい！それぞれの端末で同じスクリプトURLを設定すれば、**自動的にデータが同期**されます。

### Q3: データは安全ですか？
A: はい。データは **HTTPS 暗号化通信** で送信され、あなた専用のGoogleスプレッドシートに保存されます。

### Q4: 費用はかかりますか？
A: いいえ、**完全無料**です。Google Apps Script とスプレッドシートは無料で利用できます。

### Q5: スプレッドシートのURLを変更するには？
A: Apps Script の「デプロイ」→「デプロイを管理」→「編集」（鉛筆アイコン）→ 新しいバージョンとしてデプロイ

---

## 📞 サポート

問題が解決しない場合は、以下の情報を用意してお問い合わせください：

1. エラーメッセージのスクリーンショット
2. 設定タブの「同期ステータス」のスクリーンショット
3. Apps Script の実行ログのスクリーンショット

---

## 🎓 上級者向け: カスタマイズ

### スプレッドシートに自動集計を追加

1. **新しいシートを作成**
   - 「自動集計」という名前のシートを追加

2. **ピボットテーブルを作成**
   - 「セッション記録」シートを元にピボットテーブルを作成
   - 曜日別の平均時給、月別売上など

3. **グラフを追加**
   - 売上推移グラフ
   - 時間帯別パフォーマンスグラフ

### 週次レポートをメールで送信

Apps Script に以下のコードを追加：

```javascript
// 毎週月曜朝8時に実行
function sendWeeklyReport() {
  const ss = SpreadsheetApp.getActiveSpreadsheet();
  const records = getRecordsForLastWeek();
  
  const body = `
    先週の実績：
    総売上: ${calculateTotal(records)}円
    平均時給: ${calculateAvgHourlyWage(records)}円
    セッション数: ${records.length}回
  `;
  
  GmailApp.sendEmail(
    Session.getActiveUser().getEmail(),
    '【配信記録】週次レポート',
    body
  );
}
```

トリガーを設定：「トリガー」→「トリガーを追加」→ 毎週月曜8時

---

**設定が完了したら、実際にデータを入力して同期をテストしてみましょう！** 🎉
